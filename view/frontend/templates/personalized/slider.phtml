<?php
/**
 * NavinDBhudiya ProductRecommendation
 * Personalized Recommendations Slider Template
 *
 * @var \NavinDBhudiya\ProductRecommendation\Block\Personalized\Recommendations $block
 */

$products = $block->getProducts();
if (empty($products)) {
    return;
}

$type = $block->getRecommendationType();
$title = $block->getTitle();
$sliderId = 'personalized-slider-' . uniqid();
?>

<div class="block block-personalized-recommendations block-<?= $block->escapeHtmlAttr($type) ?> slider-mode"
     id="<?= $block->escapeHtmlAttr($sliderId) ?>-container"
     data-mage-init='{"NavinDBhudiya_ProductRecommendation/js/personalized-slider": {"sliderId": "<?= $block->escapeHtmlAttr($sliderId) ?>"}}'>
    
    <div class="block-title title">
        <strong id="block-<?= $block->escapeHtmlAttr($type) ?>-heading" role="heading" aria-level="2">
            <span class="recommendation-icon <?= $block->escapeHtmlAttr($block->getIconClass()) ?>"></span>
            <?= $block->escapeHtml($title) ?>
        </strong>
        
        <div class="slider-navigation">
            <button type="button" class="slider-prev" aria-label="<?= $block->escapeHtmlAttr(__('Previous')) ?>">
                <span>&lt;</span>
            </button>
            <button type="button" class="slider-next" aria-label="<?= $block->escapeHtmlAttr(__('Next')) ?>">
                <span>&gt;</span>
            </button>
        </div>
    </div>
    
    <div class="block-content content" aria-labelledby="block-<?= $block->escapeHtmlAttr($type) ?>-heading">
        <div class="products-slider-wrapper">
            <div class="products-slider" id="<?= $block->escapeHtmlAttr($sliderId) ?>">
                <?php foreach ($products as $product): ?>
                    <div class="slide-item">
                        <div class="product-item-info" data-container="product-slider">
                            <?php
                            $productImage = $block->getImage($product, 'category_page_grid');
                            ?>
                            <a href="<?= $block->escapeUrl($block->getProductUrl($product)) ?>" 
                               class="product photo product-item-photo" 
                               tabindex="-1">
                                <?= $productImage->toHtml() ?>
                            </a>
                            
                            <div class="product details product-item-details">
                                <strong class="product name product-item-name">
                                    <a class="product-item-link" 
                                       href="<?= $block->escapeUrl($block->getProductUrl($product)) ?>">
                                        <?= $block->escapeHtml($product->getName()) ?>
                                    </a>
                                </strong>
                                
                                <?= $block->getProductPrice($product) ?>
                                
                                <div class="product-item-inner">
                                    <div class="product actions product-item-actions">
                                        <div class="actions-primary">
                                            <?php if ($product->isSaleable()): ?>
                                                <?php $postParams = $block->getAddToCartPostParams($product); ?>
                                                <form data-role="tocart-form" 
                                                      data-product-sku="<?= $block->escapeHtmlAttr($product->getSku()) ?>"
                                                      action="<?= $block->escapeUrl($postParams['action']) ?>" 
                                                      method="post">
                                                    <input type="hidden" 
                                                           name="product" 
                                                           value="<?= $block->escapeHtmlAttr($postParams['data']['product']) ?>">
                                                    <input type="hidden" 
                                                           name="<?= /* @noEscape */ \Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED ?>" 
                                                           value="<?= /* @noEscape */ $postParams['data'][\Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED] ?>">
                                                    <?= $block->getBlockHtml('formkey') ?>
                                                    <button type="submit"
                                                            title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>"
                                                            class="action tocart primary">
                                                        <span><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                    </button>
                                                </form>
                                            <?php else: ?>
                                                <div class="stock unavailable">
                                                    <span><?= $block->escapeHtml(__('Out of stock')) ?></span>
                                                </div>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
        
        <div class="slider-pagination"></div>
    </div>
</div>

<style>
    .block-personalized-recommendations.slider-mode .block-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .slider-navigation {
        display: flex;
        gap: 10px;
    }
    
    .slider-navigation button {
        width: 36px;
        height: 36px;
        border: 1px solid #ddd;
        background: #fff;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .slider-navigation button:hover {
        background: #f5f5f5;
        border-color: #999;
    }
    
    .products-slider-wrapper {
        overflow: hidden;
    }
    
    .products-slider {
        display: flex;
        transition: transform 0.3s ease;
    }
    
    .slide-item {
        flex: 0 0 25%;
        padding: 0 10px;
        box-sizing: border-box;
    }
    
    @media (max-width: 1024px) {
        .slide-item {
            flex: 0 0 33.333%;
        }
    }
    
    @media (max-width: 768px) {
        .slide-item {
            flex: 0 0 50%;
        }
    }
    
    @media (max-width: 480px) {
        .slide-item {
            flex: 0 0 100%;
        }
    }
    
    .slider-pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 20px;
    }
    
    .slider-pagination .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .slider-pagination .dot.active {
        background: #333;
    }
</style>
